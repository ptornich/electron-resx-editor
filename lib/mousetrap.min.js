/*global define:false */
!function(e,n,t){function r(e,n,t){return e.addEventListener?void e.addEventListener(n,t,!1):void e.attachEvent("on"+n,t)}function i(e){if("keypress"==e.type){var n=String.fromCharCode(e.which)
return e.shiftKey||(n=n.toLowerCase()),n}return m[e.which]?m[e.which]:k[e.which]?k[e.which]:String.fromCharCode(e.which).toLowerCase()}function o(e,n){var t,r=e.length
if(r!==n.length)return!1
for(e=e.sort(),n=n.sort(),t=0;r>t;t++)if(e[t]!==n[t])return!1
return!0}function a(e){var n=[]
return e.shiftKey&&n.push("shift"),e.altKey&&n.push("alt"),e.ctrlKey&&n.push("ctrl"),e.metaKey&&n.push("meta"),n}function c(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function u(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function l(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function s(){if(!v){v={}
for(var e in m)e>95&&112>e||m.hasOwnProperty(e)&&(v[m[e]]=e)}return v}function f(e,n,t){return t||(t=s()[e]?"keydown":"keypress"),"keypress"==t&&n.length&&(t="keydown"),t}function p(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function d(e,n){var t,r,i,o=[]
for(t=p(e),i=0;i<t.length;++i)r=t[i],g[r]&&(r=g[r]),n&&"keypress"!=n&&b[r]&&(r=b[r],o.push("shift")),l(r)&&o.push(r)
return n=f(r,o,n),{key:r,modifiers:o,action:n}}function h(e,t){return null===e||e===n?!1:e===t?!0:h(e.parentNode,t)}function y(e){function s(e){e=e||{}
var n,t=!1
for(n in M)e[n]?t=!0:M[n]=0
t||(E=!1)}function f(e,n,t,r,i,a,c){var u,s,f=[],p=t.type
if(!w._callbacks[e])return[]
for("keyup"==p&&l(e)&&(n=[e]),u=0;u<w._callbacks[e].length;++u)if(s=w._callbacks[e][u],(r||!s.seq||M[s.seq]==s.level)&&p==s.action&&("keypress"==p&&!t.metaKey&&!t.ctrlKey||o(n,s.modifiers))){var d=!r&&s.combo==i,h=r&&s.seq==r&&s.level==a,y=!c||c&&s.callback===c
y&&(d||h)&&w._callbacks[e].splice(u,1),f.push(s)}return f}function p(e,n,t,r){w.stopCallback(n,n.target||n.srcElement,t,r)||e(n,t)===!1&&(c(n),u(n))}function h(e){"number"!=typeof e.which&&(e.which=e.keyCode)
var n=i(e)
if(n)return"keyup"==e.type&&C===n?void(C=!1):void w.handleKey(n,a(e),e)}function v(){clearTimeout(q),q=setTimeout(s,1e3)}function m(e,n,t,r){function o(n){return function(){E=n,++M[e],v()}}function a(n){p(t,n,e),"keyup"!==r&&(C=i(n)),setTimeout(s,10)}M[e]=0
for(var c=0;c<n.length;++c){var u=c+1===n.length,l=u?a:o(r||d(n[c+1]).action)
g(n[c],l,r,e,c)}}function k(e,n,t){w._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ")
var r,i=e.split(" ")
return i.length>1?{combination:e,sequence:i,isBindSequence:!0}:(r=d(e,n),w._callbacks[r.key]=w._callbacks[r.key]||[],{combination:e,sequence:i,isBindSequence:!1,info:r})}function b(e,n,r){var i=k(e,n,_)
return i.isBindSequence?void m(e,i.sequence,_,n):void f(i.info.key,i.info.modifiers,{type:i.info.action},t,i.combination,t,r)}function g(e,n,t,r,i,o){var a=k(e,t,n)
return a.isBindSequence?void m(e,a.sequence,n,t):(o||f(a.info.key,a.info.modifiers,{type:a.info.action},r,e,i),void w._callbacks[a.info.key][r?"unshift":"push"]({callback:n,modifiers:a.info.modifiers,action:a.info.action,seq:r,level:i,combo:e}))}var w=this
if(e=e||n,!(w instanceof y))return new y(e)
w.target=e,w._callbacks={},w._directMap={}
var q,M={},C=!1,K=!1,E=!1
w._handleKey=function(e,n,t){var r,i=f(e,n,t),o={},a=0,c=!1
for(r=0;r<i.length;++r)i[r].seq&&(a=Math.max(a,i[r].level))
for(r=0;r<i.length;++r)if(i[r].seq){if(i[r].level!=a)continue
c=!0,o[i[r].seq]=1,p(i[r].callback,t,i[r].combo,i[r].seq)}else c||p(i[r].callback,t,i[r].combo)
var u="keypress"==t.type&&K
t.type!=E||l(e)||u||s(o),K=c&&"keydown"==t.type},w._bindMultiple=function(e,n,r,i){for(var o=0;o<e.length;++o)g(e[o],n,r,t,t,i)},w._unbindMultiple=function(e,n,t){for(var r=0;r<e.length;++r)b(e[r],n,t)},r(e,"keypress",h),r(e,"keydown",h),r(e,"keyup",h)}for(var v,m={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},k={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},b={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},g={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},_=function(){},w=1;20>w;++w)m[111+w]="f"+w
for(w=0;9>=w;++w)m[w+96]=w
y.prototype.bind=function(e,n,t,r){var i=this
return e=e instanceof Array?e:[e],i._bindMultiple.call(i,e,n,t,r),i},y.prototype.unbind=function(e,n,t){var r=this
return e=e instanceof Array?e:[e],r._unbindMultiple.call(r,e,n,t),r},y.prototype.trigger=function(e,n){var t=this
return t._directMap[e+":"+n]&&t._directMap[e+":"+n]({},e),t},y.prototype.reset=function(){var e=this
return e._callbacks={},e._directMap={},e},y.prototype.stopCallback=function(e,n){var t=this
return(" "+n.className+" ").indexOf(" mousetrap ")>-1?!1:h(n,t.target)?!1:"INPUT"==n.tagName||"SELECT"==n.tagName||"TEXTAREA"==n.tagName||n.isContentEditable},y.prototype.handleKey=function(){var e=this
return e._handleKey.apply(e,arguments)},y.init=function(){var e=y(n)
for(var t in e)"_"!==t.charAt(0)&&(y[t]=function(n){return function(){return e[n].apply(e,arguments)}}(t))},y.init(),e.Mousetrap=y,"undefined"!=typeof module&&module.exports&&(module.exports=y),"function"==typeof define&&define.amd&&define(function(){return y})}(window,document)
